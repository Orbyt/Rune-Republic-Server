package com.rs.worldserver.model.npc;

import java.util.HashMap;
import java.util.Map;
import java.util.*;
import com.rs.worldserver.Constants;
import com.rs.worldserver.Server;
import com.rs.worldserver.io.Stream;
import com.rs.worldserver.model.Entity;
import com.rs.worldserver.model.FloorItem;
import com.rs.worldserver.model.player.Client;
import com.rs.worldserver.util.Misc;
import com.rs.worldserver.model.npc.NPCKiller;
import com.rs.worldserver.world.AnimationManager;
import com.rs.worldserver.Config;
import com.rs.worldserver.model.player.PlayerConstants;
import com.rs.worldserver.WorldMap;
import com.rs.worldserver.world.PlayerManager;
import com.rs.worldserver.model.player.Player;
import com.rs.worldserver.model.player.ActionAssistant;
import com.rs.worldserver.model.player.*;
import com.rs.worldserver.VirtualWorld;
import com.rs.worldserver.events.Event;
import com.rs.worldserver.events.EventContainer;
import com.rs.worldserver.events.EventManager;
//Shard Revolutions Generic MMORPG Server
//Copyright (C) 2008  Graham Edgecombe

//This program is free software: you can redistribute it and/or modify
//it under the terms of the GNU General Public License as published by
//the Free Software Foundation, either version 3 of the License, or
//(at your option) any later version.

//This program is distributed in the hope that it will be useful,
//but WITHOUT ANY WARRANTY; without even the implied warranty of
//MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//GNU General Public License for more details.

//You should have received a copy of the GNU General Public License
//along with this program.  If not, see <http://www.gnu.org/licenses/>.

/**
 * Represents a single NPC
 * 
 * @author Graham
 * 
 */
public class NPC extends Entity {


	public List<NPCKiller> killer = new ArrayList<NPCKiller>(350);
	/**
	 * The random walk factor.
	 */
	public static final double RANDOM_WALK_FACTOR = 0.2;

	/**
	 * NPC slot.
	 */
	public int npcId;

	/**
	 * NPC definition.
	 */
	public NPCDefinition definition;
	static public int enterboss = 20; // Kill count required = ..
	/**
	 * Walk boundaries.
	 */
	private int x1, x2, y1, y2;
	
	private Tile currentTile;

	/**
	 * HP and max hp.
	 */
	public int hp, maxHP, defence, attack, maxHit, killerId, walkingType, combat;

	/**
	 * Update flags.
	 */
	public boolean updateRequired = false, textUpdateRequired = false,
			animUpdateRequired = false, hitUpdateRequired = false,hitUpdateRequired3 = false,hitUpdateRequired4 = false,
			dirUpdateRequired = false, underAttack = false, hitUpdateRequired2 = false, jadMage, jadRange, jadMelee,dFire, maging, druidMaging,magicFailed,range;

	/**
	 * String update data.
	 */
	private String textUpdate;

	/**
	 * Integeral update data.
	 */
	public int animNumber, direction, hit, hitType;

	/**
	 * Walking.
	 */
	public boolean isWalking, wasWalking, randomWalk;

	/**
	 * Raw direction.
	 */
	private int rawDirection = -1;

	/**
	 * List of attackers.
	 */
	private Map<Client, Integer> attackers = new HashMap<Client, Integer>();

	/**
	 * List of attackers.
	 */
	private Map<Client, Integer> previousAttackers = null;

	/**
	 * Primary attacker.
	 */
	private Client attacker = null;

	/**
	 * We're dead.
	 */
	public boolean isDead = false;

	/**
	 * Is dead waiting...
	 */
	private boolean isDeadWaiting = false;

	/**
	 * Timer lol. One of the only ones I use! :O
	 */
	private int isDeadTimer = -1;

	/**
	 * Are we hidden?
	 */
	private boolean isHidden = false;

	/**
	 * Is dead teleporting.
	 */
	private boolean isDeadTeleporting = false;

	/**
	 * Where to respawn.
	 */
	public int spawnAbsX, spawnAbsY;
	public int atkTimer = 0;
	public int agressive = 0;
	public boolean walkingHome, isToBeRemoved = false;
	public int freezeTimer, attackTimer, killedBy, hitDelayTimer, actionTimer, makeX, makeY;

	/**
	 * @return the attacker
	 */
	public NPC targetNPC = null;
	
	/**
	 * Turns an NPC to a player.
	 * 
	 * @param playerId
	 */
	public void faceTo(int playerId) {
		this.rawDirection = 32768 + playerId;
		this.dirUpdateRequired = true;
		this.updateRequired = true;
	}
	/**
	 * Turns an NPC.
	 * 
	 * @param dir
	 */
	public void face(int dir) {
		this.rawDirection = dir;
		this.dirUpdateRequired = true;
		this.updateRequired = true;
	}
	public int getNpcKillerId(int npcId) {
		int oldDamage = 0;
		int count = 0;
		int killerId = 0;
		
		for (int p = 1; p < Constants.MAXIMUM_PLAYERS; p++)  {	
			if (PlayerManager.getSingleton().getPlayers()[p] != null) {
				if(PlayerManager.getSingleton().getPlayers()[p].killingNpcIndex == npcId) {
					if(PlayerManager.getSingleton().getPlayers()[p].totalDamageDealt > oldDamage) {
						oldDamage = PlayerManager.getSingleton().getPlayers()[p].totalDamageDealt;
						killerId = PlayerManager.getSingleton().getPlayers()[p].playerId;
					}
					PlayerManager.getSingleton().getPlayers()[p].totalDamageDealt = 0;
				}	
			}
		}				
		return killerId;
	}
	/**
	 * Creates the npc.
	 * 
	 * @param npcId
	 *            NPC slot.
	 * @param definition
	 *            NPC definition.
	 * @param absX
	 * @param absY
	 * @param heightLevel
	 */
	
	public NPC(int npcId, NPCDefinition definition, int absX, int absY,
			int heightLevel, int walkingType) {
		this.npcId = npcId;
		this.definition = definition;
		this.maxHP = definition.getHealth();
		this.hp = definition.getHealth();
		this.setAbsX(absX);
		this.setAbsY(absY);
		this.makeX = absX;
		this.makeY = absY;
		this.spawnAbsX = absX;
		this.spawnAbsY = absY;
		this.setHeightLevel(heightLevel);
		this.maxHit = maxHit;
		this.attack = attack;
		this.defence = defence;
		this.walkingType = walkingType;
		this.randomWalk = true;

	}
	 /**
	 * Gets the maximum hit
	 * 
	 * @return
	 */
	public int getMaximumHit() {
		
		switch(definition.type) {
		
		case 2029:
		case 2025:
		case 2026:
		case 2027:
		case 2028:
		case 2030:
			return 30;
		
		default:
			return 5;
		}
	}
	/**
	 * Hit the npc.
	 * 
	 * @param client
	 * @param hit
	 * @param type
	 */
	public void hit(Client client, int hit, int type) {
		if (hit == 0 && type == 1) {
			type = 0;
		}
		int hittotal = this.attackers.get(client);
		this.attackers.put(client, hittotal + hit);
		this.hit = this.hit + hit;
		this.hitType = type;
		this.hp = this.hp - hit;
		if (this.hp <= 0) {
			this.hp = 0;
		}
		this.hitUpdateRequired = true;
		this.updateRequired = true;
	}

	/**
	 * Gives out this npcs drops.
	 */
	public void processDrops() {
		Client d = (Client) PlayerManager.getSingleton().getPlayers()[NPCKiller.getKiller(this)];
		int npc = -1;
		if(d != null) {
			/*for(int l: FightCave.Tzhaar_Npcs) {
				if(definition.type == l) {
					d.KilledTzhaars++;
				}
			}*/		
			for(npc = 0; npc < Config.NPC_DROPS.length; npc++){
				if(definition.type == Config.NPC_DROPS[npc][0]) {
					if(Misc.random(Config.NPC_DROPS[npc][3]) == 0) {
						FloorItem item = new FloorItem(Config.NPC_DROPS[npc][1], Config.NPC_DROPS[npc][2], d, getAbsX(), getAbsY(), getHeightLevel());
						Server.getItemManager().newDropFromNPC(item, d);
					}	
				}
			}
			if(Misc.random(50) == 30) {
				FloorItem b = new FloorItem(d.getActionAssistant().randomGem(), 1, d, getAbsX(), getAbsY(), getHeightLevel());
				Server.getItemManager().newDropFromNPC(b, d);
			}
	
			if(Misc.random(50) == 15) {
				FloorItem b = new FloorItem(d.getActionAssistant().randomHerb(), 1, d, getAbsX(), getAbsY(), getHeightLevel());
				Server.getItemManager().newDropFromNPC(b, d);
			}	
			if(Misc.random(100) == 69) {
				FloorItem b = new FloorItem(d.getActionAssistant().randomOre(), 30, d, getAbsX(), getAbsY(), getHeightLevel());
				Server.getItemManager().newDropFromNPC(b, d);
			}	
			if(Misc.random(200) == 102) {
				FloorItem b = new FloorItem(d.getActionAssistant().randomBar(), 20, d, getAbsX(), getAbsY(), getHeightLevel());
				Server.getItemManager().newDropFromNPC(b, d);
			}	
			if(Misc.random(50) == 20) {
				FloorItem b = new FloorItem(d.getActionAssistant().randomBolt(), Misc.random(300), d, getAbsX(), getAbsY(), getHeightLevel());
				Server.getItemManager().newDropFromNPC(b, d);
			}			
			if(Misc.random(1000) == 369) {
				FloorItem b = new FloorItem(2366, 1, d, getAbsX(), getAbsY(), getHeightLevel());
				Server.getItemManager().newDropFromNPC(b, d);
			}	
			if(Misc.random(1000) == 489) {
				FloorItem b = new FloorItem(2368, 1, d, getAbsX(), getAbsY(), getHeightLevel());
				Server.getItemManager().newDropFromNPC(b, d);
			}	
		d.inCombat = false;
		d.isFighting = false;			
		}

	}
	
	//}
	public boolean inWild() {
		if((absX > 2941 && absX < 3392 && absY > 3518 && absY < 3967) ||
		  (absX > 3009 && absX < 3060 && absY > 10303 && absY < 10356) ||
		  (absX > 3078 && absX < 3134 && absY > 9918 && absY < 9999)
		  
		  ){
			return true;
		}
		return false;
	}
	/**
	 * Processing.
	 */
	public void process() {
				
				annoyNpcs(npcId);
				if (actionTimer > 0) {
					actionTimer--;
				}
				
				if (freezeTimer > 0) {
					freezeTimer--;
				}
				
				if (hitDelayTimer > 0) {
					hitDelayTimer--;
				}
				
				if (hitDelayTimer == 1) {
					hitDelayTimer = 0;
					applyDamage(definition.type);
				}
				
				if(attackTimer > 0) {
					attackTimer--;
				}
				if(underAttack && !walkingHome) {
					if(!isDead) {
						int p = killerId;
						if(PlayerManager.getSingleton().getPlayers()[p] != null ) {
							Client c = (Client)	PlayerManager.getSingleton().getPlayers()[killerId];
							followPlayer(c);
							if(attackTimer == 0) {						
								if(PlayerManager.getSingleton().getPlayers()[p] != null) {
									attackPlayer(c, npcId);								
								} else {
									killerId = 0;
									underAttack = false;
									killedBy = 0;
									facePlayer(0);
								}
							}
						} else {
							killerId = 0;
							underAttack = false;
							killedBy = 0;
							facePlayer(0);
						}

					}	
				}
				if(!underAttack && randomWalk && !isDead && !isDeadWaiting){
					annoyNpcs(npcId);
				}
			
				/***
				* Random walking and walking home
				***/
				if((!underAttack || walkingHome) && randomWalk && !isDead){
					//annoyNpcs(npcId);
					//killerId = 0;
					//underAttack = false;
					//killedBy = 0;
					//facePlayer(0);
					if(definition.type == 127) {
					if((getAbsX() > makeX + 2) || (getAbsX() < makeX - 2) || (getAbsY() > makeY + 2) || (getAbsY() < makeY - 2)) {
						walkingHome = true;
					} else if((getAbsX() > makeX + Config.NPC_RANDOM_WALK_DISTANCE) || (getAbsX() < makeX - Config.NPC_RANDOM_WALK_DISTANCE) || (getAbsY() > makeY + Config.NPC_RANDOM_WALK_DISTANCE) || (getAbsY() < makeY - Config.NPC_RANDOM_WALK_DISTANCE)) {
						walkingHome = true;
					}
					}
					if (walkingHome && getAbsX() == makeX && getAbsY() == makeY) {
						walkingHome = false;
					} else if(walkingHome) {
						moveX = GetMove(getAbsX(), makeX);
			      		moveY = GetMove(getAbsY(), makeY);
						getNextNPCMovement(definition.type);
						updateRequired = true;
					}
					if(walkingType == 1) {
						if(Misc.random(6)== 1 && !walkingHome) {
							int MoveX = 0;
							int MoveY = 0;			
							int Rnd = Misc.random(9);
							if (Rnd == 1) {
								MoveX = 1;
								MoveY = 1;
							} else if (Rnd == 2) {
								MoveX = -1;
							} else if (Rnd == 3) {
								MoveY = -1;
							} else if (Rnd == 4) {
								MoveX = 1;
							} else if (Rnd == 5) {
								MoveY = 1;
							} else if (Rnd == 6) {
								MoveX = -1;
								MoveY = -1;
							} else if (Rnd == 7) {
								MoveX = -1;
								MoveY = 1;
							} else if (Rnd == 8) {
								MoveX = 1;
								MoveY = -1;
							}
										
							if (MoveX == 1) {
								if (getAbsX() + MoveX < makeX + 1) {
									moveX = MoveX;
								} else {
									moveX = 0;
								}
							}
							
							if (MoveX == -1) {
								if (getAbsX() - MoveX > makeX - 1)  {
									moveX = MoveX;
								} else {
									moveX = 0;
								}
							}
							
							if(MoveY == 1) {
								if(getAbsY() + MoveY < makeY + 1) {
									moveY = MoveY;
								} else {
									moveY = 0;
								}
							}
							
							if(MoveY == -1) {
								if(getAbsY() - MoveY > makeY - 1)  {
									moveY = MoveY;
								} else {
									moveY = 0;
								}
							}
							if(!VirtualWorld.I(heightLevel, getAbsX(), getAbsY(), (getAbsX() + moveX), 
										(getAbsY() + moveY), 0))
							{
								moveX = 0;
								moveY = 0;
							}
							
							
					int x = (getAbsX() + moveX);
					int y = (getAbsY() + moveY);		
					if (VirtualWorld.I(heightLevel, getAbsX(), getAbsY(), getAbsX()-moveX, getAbsY()-moveY, 0))
						getNextNPCMovement(definition.type);
					else {
						moveX = 0;
						moveY = 0;
					}        							
					updateRequired = true;
						}
					}
				}		
		if (isDead) {

			if (!isDeadWaiting && !isDeadTeleporting) {
				animNumber = AnimationManager.getDeathAnimation(this);
				animUpdateRequired = true;
				updateRequired = true;
				isDeadWaiting = true;
				underAttack = false;
				if(npcInMulti()) {
					killedBy = getNpcKillerId(definition.type);
				} else {
					killedBy = killerId;
				}
				isDeadTimer = 4;
				freezeTimer = 0;
				if (isWalking) {
					wasWalking = true;
				}
				Client c = (Client) getAttacker();
				if(c != null) {
					if(c.sounds == 1) {
						c.getActionAssistant().frame174(getNpcDeadSound(), 000, 000);	
					}	
					c.isFighting = false;
					/*if (definition.type == 3803 ||definition.type == 3804 ||definition.type == 3805 ||
					    definition.type == 3806 ||definition.type == 3807 ||definition.type == 3808 ||
						definition.type == 3809 ||definition.type == 2627 ||definition.type == 2628 ||
						definition.type == 2738 ||definition.type == 2629 ||definition.type == 2630 ||
						definition.type == 2631 ||definition.type == 2632 ||definition.type == 2741 ||
						definition.type == 2742 ||definition.type == 2743 ||definition.type == 2744 ||
						definition.type == 2745 ||definition.type == 2746) {
						AnimationManager.getDeathAnimation(this);
						animUpdateRequired = true;
						updateRequired = true;
						processDrops();
						isToBeRemoved = true;
						c.oldNpcIndex = 0;
						c.npcIndex = 0;
						c.getCombat().resetAttack();
						animUpdateRequired = true;
						updateRequired = true;
						isDeadWaiting = false;
						isHidden = true;
					}				
					if (definition.type == 3777) {
						PlayerManager.portal1 = true;
						isToBeRemoved = true;
						c.oldNpcIndex = 0;
						c.npcIndex = 0;
						c.getCombat().resetAttack();
						animUpdateRequired = true;
						updateRequired = true;
						isDeadWaiting = false;
						isHidden = true;
					}
					if (definition.type == 3778) {
						PlayerManager.portal2 = true;
						isToBeRemoved = true;
						c.oldNpcIndex = 0;
						c.npcIndex = 0;
						c.getCombat().resetAttack();
						animUpdateRequired = true;
						updateRequired = true;
						isDeadWaiting = false;
						isHidden = true;
					}
					if (definition.type == 3779) {
						PlayerManager.portal3 = true;
						isToBeRemoved = true;
						c.oldNpcIndex = 0;
						c.npcIndex = 0;
						c.getCombat().resetAttack();
						animUpdateRequired = true;
						updateRequired = true;
						isDeadWaiting = false;
						isHidden = true;
					}
					if (definition.type == 3780) {
						PlayerManager.portal4 = true;
						isToBeRemoved = true;
						c.oldNpcIndex = 0;
						c.npcIndex = 0;
						c.getCombat().resetAttack();
						animUpdateRequired = true;
						updateRequired = true;
						isDeadWaiting = false;
						isHidden = true;
					}*/
					if (absX >= 2800 && absX <= 3000 && absY >= 5245 && absY <= 5385) {
						if (definition.type == 116 || definition.type == 113 || definition.type == 71 || definition.type == 123 || definition.type == 101 || definition.type == 122 || definition.type == 102 || definition.type == 100 ) {
							if (c.bandosPoints == enterboss) {
								c.getActionAssistant().sendMessage("@red@You already have "+enterboss+ " kills! Enter the bandos room!");
								}
							else {
								c.bandosPoints += 1;
								c.getActionAssistant().updateKillCount(1);
							}
						}
						else if ( definition.type == 3823 || definition.type == 3829 ) {
							if (c.saraPoints == enterboss) {
								c.getActionAssistant().sendMessage("@red@You already have "+enterboss+ " kills! Enter the sara room!");
								}
							else {
								c.saraPoints += 1;
								c.getActionAssistant().updateKillCount(3);
							}
						}
						else if ( definition.type == 182 || definition.type == 3821 ) {
							if (c.armaPoints == enterboss) {
								c.getActionAssistant().sendMessage("@red@You already have "+enterboss+ " kills! Enter the arma room!");
								}
							else {
								c.armaPoints += 1;
								c.getActionAssistant().updateKillCount(0);
							}
						}
						else if ( definition.type == 3818 || definition.type == 1618 ||  definition.type == 83 || definition.type == 1030 || definition.type == 1031 || definition.type == 1032 || definition.type == 708 ) {
							if (c.zamPoints == enterboss) {
								c.getActionAssistant().sendMessage("@red@You already have "+enterboss+ " kills! Enter the boss room!");
								}
							else {
								c.zamPoints += 1;
								c.getActionAssistant().updateKillCount(2);
							}
						}
					}
					
					if (definition.type == 1115 || definition.type == 3783 || definition.type == 3810 || definition.type == 3811) {
						c.gwdboss++;
						c.NRAchievements.checkMonsters(c,2);
					}
					
					if (definition.type == 50){
						c.kbd++;
						c.NRAchievements.checkMonsters(c,3);
					}
					if (definition.type == 53){
						c.rdrags++;
						c.NRAchievements.checkMonsters(c,0);
					}
					if (definition.type == 78){
						c.bats++;
						c.NRAchievements.checkMonsters(c,1);
					}
					if (definition.type == 3793){
						c.spirit++;
						c.NRAchievements.checkMonsters(c,4);
					}
					if (definition.type == 3200){
						c.chaos++;
						c.NRAchievements.checkMonsters(c,5);
					} 
					if (definition.type == 934){
						c.nez++;
						c.NRAchievements.checkMonsters(c,6);
					}
					if (definition.type == 72){
						c.mdrag++;
						c.NRAchievements.checkMonsters(c,7);
					}
					if (definition.type == 3340){
						c.gmoles++;
						c.NRAchievements.checkMonsters(c,8);
					}
					
					int slaymultiple = 1;
				if (definition.type == 1653 && c.slayerTask == 1653) {
					c.getActionAssistant().addSkillXP((slaymultiple*5), 18);
					c.getActionAssistant().refreshSkill(18); //hand
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
					
				}
				if (definition.type == 1676 && c.slayerTask == 1677) {
					c.getActionAssistant().addSkillXP((slaymultiple*85), 18);
					c.getActionAssistant().refreshSkill(18); //experiment
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}					
				if (definition.type == 1677 && c.slayerTask == 1677) {
					c.getActionAssistant().addSkillXP((slaymultiple*85), 18);
					c.getActionAssistant().refreshSkill(18); //experiment
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}	
				if (definition.type == 122 && c.slayerTask == 122) {
					c.getActionAssistant().addSkillXP((slaymultiple*25), 18);
					c.getActionAssistant().refreshSkill(18); //hobgoblin
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}		
				if (definition.type == 123 && c.slayerTask == 122) {
					c.getActionAssistant().addSkillXP((slaymultiple*25), 18);
					c.getActionAssistant().refreshSkill(18); //hobgoblin
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}				
				if (definition.type == 1265 && c.slayerTask == 1265) {
					c.getActionAssistant().addSkillXP((slaymultiple*5), 18);
					c.getActionAssistant().refreshSkill(18); //rock crab
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}	
				if (definition.type == 1832 && c.slayerTask == 1832 ) {
					c.getActionAssistant().addSkillXP((slaymultiple*5), 18);
					c.getActionAssistant().refreshSkill(18); //cav bug
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}	
				if (definition.type == 1601 && c.slayerTask == 1601 ) {
					c.getActionAssistant().addSkillXP((slaymultiple*25), 18);
					c.getActionAssistant().refreshSkill(18); //cave crawler
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}	
				if (definition.type == 1612 && c.slayerTask == 1612) {
					c.getActionAssistant().addSkillXP((slaymultiple*22), 18);
					c.getActionAssistant().refreshSkill(18); //banshe
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}		
				if (definition.type == 1831 && c.slayerTask == 1831) {
					c.getActionAssistant().addSkillXP((slaymultiple*25), 18);
					c.getActionAssistant().refreshSkill(18); //cave slime
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}		
				if (definition.type == 1622 && c.slayerTask == 1622) {
					c.getActionAssistant().addSkillXP((slaymultiple*27), 18);
					c.getActionAssistant().refreshSkill(18); //rock slug
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}	
				if (definition.type == 1620 && c.slayerTask == 1620) {
					c.getActionAssistant().addSkillXP((slaymultiple*37), 18);
					c.getActionAssistant().refreshSkill(18); //cockatrice
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}	
				if (definition.type == 112 && c.slayerTask == 112 ) {
					c.getActionAssistant().addSkillXP((slaymultiple*60), 18);
					c.getActionAssistant().refreshSkill(18); //moss giant
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}	
				if (definition.type == 117 && c.slayerTask == 117) {
					c.getActionAssistant().addSkillXP((slaymultiple*35), 18);
					c.getActionAssistant().refreshSkill(18); //hill giant
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}	
				if (definition.type == 1633 && c.slayerTask == 1633) {
					c.getActionAssistant().addSkillXP((slaymultiple*45), 18);
					c.getActionAssistant().refreshSkill(18); //Pyrefiend
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}	
				if (definition.type ==  941 && c.slayerTask == 941) {
					c.getActionAssistant().addSkillXP((slaymultiple*75), 18);
					c.getActionAssistant().refreshSkill(18); //green dragon
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}	
				if (definition.type == 55 && c.slayerTask == 55 ) {
					c.getActionAssistant().addSkillXP((slaymultiple*112), 18);
					c.getActionAssistant().refreshSkill(18); //blue dragon
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}	
				if (definition.type == 1632 && c.slayerTask == 1632 ) {
					c.getActionAssistant().addSkillXP((slaymultiple*88), 18);
					c.getActionAssistant().refreshSkill(18); //turoth
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}	
				if (definition.type == 1609 && c.slayerTask == 1609) {
					c.getActionAssistant().addSkillXP((slaymultiple*97), 18);
					c.getActionAssistant().refreshSkill(18); //kurask
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}	
				if (definition.type == 84 && (c.slayerTask == 84 || c.slayerTask == 677)) {
					c.getActionAssistant().addSkillXP((slaymultiple*157), 18);
					c.getActionAssistant().refreshSkill(18); //black demon
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}	
				if (definition.type == 677 && (c.slayerTask == 677 || c.slayerTask == 84)) {
					c.getActionAssistant().addSkillXP((slaymultiple*157), 18);
					c.getActionAssistant().refreshSkill(18); //black demon
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}				
				if (definition.type == 83  && c.slayerTask == 83) {
					c.getActionAssistant().addSkillXP((slaymultiple*157), 18);
					c.getActionAssistant().refreshSkill(18); //Greater Demon
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}						
				if (definition.type == 1616 && c.slayerTask == 1616) {
					c.getActionAssistant().addSkillXP((slaymultiple*75), 18);
					c.getActionAssistant().refreshSkill(18); //Basilisk
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}
				if (definition.type == 1637 && c.slayerTask == 1637) {
					c.getActionAssistant().addSkillXP((slaymultiple*75), 18);
					c.getActionAssistant().refreshSkill(18); //jelly
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}
				if (definition.type == 1618 && c.slayerTask == 1619) {
					c.getActionAssistant().addSkillXP((slaymultiple*120), 18);
					c.getActionAssistant().refreshSkill(18);//Bloodveld
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}
				if (definition.type == 1619 && c.slayerTask == 1619) {
					c.getActionAssistant().addSkillXP((slaymultiple*120), 18);
					c.getActionAssistant().refreshSkill(18);//Bloodveld
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}				
				if (definition.type == 1643 && c.slayerTask == 1643) {
					c.getActionAssistant().addSkillXP((slaymultiple*60), 18);
					c.getActionAssistant().refreshSkill(18);//Infernal Mage
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}
				if (definition.type == 1604 && c.slayerTask == 1604) {
					c.getActionAssistant().addSkillXP((slaymultiple*60), 18);
					c.getActionAssistant().refreshSkill(18);//Abby Specs
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}
				if (definition.type == 1624 && c.slayerTask == 1624) {
					c.getActionAssistant().addSkillXP((slaymultiple*105), 18);
					c.getActionAssistant().refreshSkill(18);//Dust Devil
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}
				if (definition.type == 1610 && c.slayerTask == 1610) {
					c.getActionAssistant().addSkillXP((slaymultiple*105), 18);
					c.getActionAssistant().refreshSkill(18);//Garg
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}
				if (definition.type == 1613 && c.slayerTask == 1613) {
					c.getActionAssistant().addSkillXP((slaymultiple*105), 18);
					c.getActionAssistant().refreshSkill(18);//Nech
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}
				if (definition.type == 1615 && c.slayerTask == 1615) {
					c.getActionAssistant().addSkillXP((slaymultiple*150), 18);
					c.getActionAssistant().refreshSkill(18);//Abbys
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}
				if (definition.type == 2783 && c.slayerTask == 2783) {
					c.getActionAssistant().addSkillXP((slaymultiple*225), 18);
					c.getActionAssistant().refreshSkill(18);//Dark beast
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}
				if (definition.type == 2783 && c.slayerTask == 2783) {
					c.getActionAssistant().addSkillXP((slaymultiple*225), 18);
					c.getActionAssistant().refreshSkill(18);//Dark beast
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}
				if ((definition.type == 3818 || definition.type == 3829) && c.slayerTask == 3818) {
					c.getActionAssistant().addSkillXP((slaymultiple*150), 18);
					c.getActionAssistant().refreshSkill(18);//spirit mage
					c.getActionAssistant().requestUpdates();
					c.slayerAmount -= 1;
					if(c.slayerAmount <= 0){
						c.slayerAmount = -1;
						c.slayerTask = -1;
						c.slayerPoints += 1;
						c.getActionAssistant().sendMessage("You have completed your task. Talk to a slayer master to get a new one.");
					}
				}
					
				}
				isWalking = false;
				if (previousAttackers == null) {
					previousAttackers = attackers;
					attackers = new HashMap<Client, Integer>();
					attackers.putAll(previousAttackers);
				}
			} else if (isDeadTeleporting) {
				if (isDeadTimer == 0) {
					isDead = false;
					isHidden = false;
					if (wasWalking) {
						isWalking = true;
					}
					hp = maxHP;
					isDeadTeleporting = false;
					isDead = false;
					setAbsX(spawnAbsX);
					setAbsY(spawnAbsY);
				}
				isDeadTimer--;
			} else {
				if (isDeadTimer == 0) {
					animUpdateRequired = true;
					updateRequired = true;
					isDeadWaiting = false;
					isHidden = true;
					isDeadTimer = definition.getRespawn();
					isDeadTeleporting = true;
					processDrops();
					killerId = 0;
				}
				isDeadTimer--;
			}
		}
	}

	/**
	 * Appends the NPC update block
	 * 
	 * @param str
	 */
	/**
	 * Appends the NPC update block
	 * 
	 * @param str
	 */
	 public int gfxId;
	 public int viewX, viewY, moveX, moveY;
	 public int gfxDelay, animDelay, faceX, faceY, transformId;
	 public boolean secondHitUpdateRequired, gfxUpdateRequired, faceToEntityUpdateRequired, transformUpdateRequired, faceToUpdateRequired;
	/**
	*
	Graphics
	*
	**/	
	
	public int mask80var1 = 0;
    public int mask80var2 = 0;
    protected boolean mask80update = false;
	
    public void appendMask80Update(Stream str) {
		str.writeWord(mask80var1);
	    str.writeDWord(mask80var2);
    }
	
	public void gfx100(int gfx){
		mask80var1 = gfx;
        mask80var2 = 6553600;
        mask80update = true;
		updateRequired = true;
	}
	
	public void gfx0(int gfx){
		mask80var1 = gfx;
        mask80var2 = 65536;
        mask80update = true;
		updateRequired = true;
	}
	
	public void appendAnimUpdate(Stream str) {
		str.writeWordBigEndian(animNumber);
		str.writeByte(1);
	}
	
	public void appendHitUpdate(Stream str) {		
		if (hp <= 0) {
			isDead = true;
		}
		str.writeByteC(hit); 
		if (hit > 0) {
			str.writeByteS(1); 
		} else {
			str.writeByteS(0); 
		}
		str.writeByteS(Misc.getCurrentHP(hp, maxHP, 100));
		str.writeByteC(100);		
		//str.writeByteS(hp); 
		//str.writeByteC(maxHP); 	
	}
	public int hit2,hit3,hit4;
	public void appendHitUpdate2(Stream str) {		
		if (hp <= 0) {
			isDead = true;
		}
		str.writeByteA(hit2); 
		if (hit2 > 0) {
			str.writeByteC(1); 
		} else {
			str.writeByteC(0); 
		}	
		str.writeByteS(Misc.getCurrentHP(hp, maxHP, 100));
		str.writeByteC(100); 	
	}	
	public void appendHitUpdate3(Stream str) {		
		if (hp <= 0) {
			isDead = true;
		}
		str.writeByteA(hit3); 
		if (hit3 > 0) {
			str.writeByteC(1); 
		} else {
			str.writeByteC(0); 
		}	
		str.writeByteS(Misc.getCurrentHP(hp, maxHP, 100));
		str.writeByteC(100); 	
	}		
		public void appendHitUpdate4(Stream str) {		
		if (hp <= 0) {
			isDead = true;
		}
		str.writeByteA(hit4); 
		if (hit4 > 0) {
			str.writeByteC(1); 
		} else {
			str.writeByteC(0); 
		}	
		str.writeByteS(Misc.getCurrentHP(hp, maxHP, 100));
		str.writeByteC(100); 	
	}	
	/*public void appendHitUpdate(Stream str) {
		str.writeByteC(hit); // What the perseon got 'hit' for
		str.writeByteS(hitType); // 0: red hitting - 1: blue hitting
		str.writeByteS(hp); // Their current hp, for HP bar
		str.writeByteC(maxHP); // Their max hp, for HP bar
	}*/
	/**
	*
	Face
	*
	**/
	
	public int FocusPointX = -1, FocusPointY = -1;
	public int face = 0,HP, MaxHP, hitDiff, hitDiff2;
	
	private void appendSetFocusDestination(Stream str) {
        str.writeWordBigEndian(FocusPointX);
        str.writeWordBigEndian(FocusPointY);
    }
	
	public void turnNpc(int i, int j) {
        FocusPointX = 2 * i + 1;
        FocusPointY = 2 * j + 1;
        updateRequired = true;

    }
	
	public void appendFaceEntity(Stream str) {
		str.writeWord(face);
	}
        	
	public void facePlayer(int player) {
		face = player + 32768;
		dirUpdateRequired = true;
		updateRequired = true;
	}

	public void appendFaceToUpdate(Stream str) {
			str.writeWordBigEndian(viewX);
			str.writeWordBigEndian(viewY);
			
	}
	
	
	public void appendNPCUpdateBlock(Stream str) {
		if(!updateRequired) return ;		
		int updateMask = 0;
		if(animUpdateRequired) updateMask |= 0x10;
		if(hitUpdateRequired2) updateMask |= 8;
		if(mask80update) updateMask |= 0x80;
		if(textUpdateRequired) updateMask |= 1;
		if(dirUpdateRequired) updateMask |= 0x20;
		if(hitUpdateRequired) updateMask |= 0x40;	
		if(FocusPointX != -1) updateMask |= 4;		
			
		str.writeByte(updateMask);
				
		if (animUpdateRequired) appendAnimUpdate(str);
		if (hitUpdateRequired2) appendHitUpdate2(str);

		if (mask80update)       appendMask80Update(str);
		if (dirUpdateRequired)  appendFaceEntity(str);
		if(textUpdateRequired) 
		{
			str.writeString(textUpdate);
		}
		if (hitUpdateRequired)  appendHitUpdate(str);
		if(FocusPointX != -1) appendSetFocusDestination(str);
		
	}

	public void clearUpdateFlags() {
		updateRequired = false;
		textUpdateRequired = false;
		hitUpdateRequired = false;
		hitUpdateRequired2 = false;
		hitUpdateRequired3 = false;
		hitUpdateRequired4 = false;
		animUpdateRequired = false;
		dirUpdateRequired = false;
		mask80update = false;
		textUpdate = null;
		moveX = 0;
		moveY = 0;
		direction = -1;
		FocusPointX = -1;
		FocusPointY = -1;
	}

	/**
	 * Updates NPC movement
	 * 
	 * @param str
	 */
	public void updateNPCMovement(Stream str) {
		if (direction == -1) {
			// don't have to update the npc position, because the npc is just
			// standing
			if (updateRequired) {
				// tell client there's an update block appended at the end
				str.writeBits(1, 1);
				str.writeBits(2, 0);
			} else
				str.writeBits(1, 0);
		} else {
			// send "walking packet"
			str.writeBits(1, 1);
			str.writeBits(2, 1); // updateType
			str.writeBits(3, Misc.xlateDirectionToClient[direction]);
			if (updateRequired)
				str.writeBits(1, 1); // tell client there's an update block
										// appended at the end
			else
				str.writeBits(1, 0);
		}
	}

	/**
	 * @param definition
	 *            the definition to set
	 */
	public void setDefinition(NPCDefinition definition) {
		this.definition = definition;
	}

	/**
	 * @return the definition
	 */
	public NPCDefinition getDefinition() {
		return definition;
	}

	/**
	 * @param animNumber
	 *            the animNumber to set
	 */
	public void setAnimNumber(int animNumber) {
		this.animNumber = animNumber;
	}

	/**
	 * @return the animNumber
	 */
	public int getAnimNumber() {
		return animNumber;
	}

	/**
	 * @param animUpdateRequired
	 *            the animUpdateRequired to set
	 */
	public void setAnimUpdateRequired(boolean animUpdateRequired) {
		this.animUpdateRequired = animUpdateRequired;
	}

	/**
	 * @return the animUpdateRequired
	 */
	public boolean isAnimUpdateRequired() {
		return animUpdateRequired;
	}

	/**
	 * @param updateRequired
	 *            the updateRequired to set
	 */
	public void setUpdateRequired(boolean updateRequired) {
		this.updateRequired = updateRequired;
	}

	/**
	 * @return the updateRequired
	 */
	public boolean isUpdateRequired() {
		return updateRequired;
	}


	/**
	 * @param attacker
	 *            the attacker to set
	 */
	public void setAttacker(Client attacker) {
		this.attacker = attacker;
	}

	/**
	 * @return the attacker
	 */
	public Client getAttacker() {
		return attacker;
	}

	/**
	 * @return the attackers
	 */
	public Map<Client, Integer> getAttackers() {
		return attackers;
	}

	/**
	 * @param isWalking
	 *            the isWalking to set
	 */
	public void setWalking(boolean isWalking) {
		this.isWalking = isWalking;
		this.randomWalk = true;
	}

	/**
	 * @return the isWalking
	 */
	public boolean isWalking() {
		return isWalking;
	}

	/**
	 * @param wasWalking
	 *            the wasWalking to set
	 */
	public void setWasWalking(boolean wasWalking) {
		this.wasWalking = wasWalking;
	}

	/**
	 * @return the wasWalking
	 */
	public boolean isWasWalking() {
		return wasWalking;
	}

	/**
	 * @param isDead
	 *            the isDead to set
	 */
	public void setDead(boolean isDead) {
		this.isDead = isDead;
	}

	/**
	 * @return the isDead
	 */
	public boolean isDead() {
		return isDead;
	}

	/**
	 * @param npcId
	 *            the npcId to set
	 */
	public void setNpcId(int npcId) {
		this.npcId = npcId;
	}

	/**
	 * @return the npcId
	 */
	public int getNpcId() {
		return npcId;
	}

	/**
	 * @param isHidden
	 *            the isHidden to set
	 */
	public void setHidden(boolean isHidden) {
		this.isHidden = isHidden;
	}

	/**
	 * @return the isHidden
	 */
	public boolean isHidden() {
		return isHidden;
	}

	/**
	 * @param x1
	 *            the x1 to set
	 */
	public void setX1(int x1) {
		this.x1 = x1;
	}
	public void defence(int defence) {
		this.defence = defence;
	}
	public void attack(int attack) {
		this.attack = attack;
	}
	public void maxHit(int maxHit) {
		this.maxHit = maxHit;
	}
	public void walkingType(int walkingType) {
		this.walkingType = walkingType;
	}
	/**
	 * @return the x1
	 */
	public int getX1() {
		return x1;
	}

	/**
	 * @param y1
	 *            the y1 to set
	 */
	public void setY1(int y1) {
		this.y1 = y1;
	}

	/**
	 * @return the y1
	 */
	public int getY1() {
		return y1;
	}

	/**
	 * @param x2
	 *            the x2 to set
	 */
	public void setX2(int x2) {
		this.x2 = x2;
	}

	/**
	 * @return the x2
	 */
	public int getX2() {
		return x2;
	}

	/**
	 * @param y2
	 *            the y2 to set
	 */
	public void setY2(int y2) {
		this.y2 = y2;
	}

	/**
	 * @return the y2
	 */
	public int getY2() {
		return y2;
	}
	/**
	* Death Sounds
	**/
	public int getNpcDeadSound() {
		
		switch(definition.type) {
			case 47:
			case 86:
			case 87:
			case 88:
			case 224:
			case 446:
			case 748:
			case 950:
			case 978:
			case 2032:
			case 2033:
				return 15;
			case 118:
			case 120:
			case 121:
			case 119:
			case 206:
			case 232:
			case 382:
			case 2423:
				return 905;
			case 90:
			case 91:
			case 92:
			case 93:
			case 94:
			case 459:
			case 750:
			case 1471:
			case 1539:
			case 1973:
			case 2036:
			case 2037:
				return 1051;
			default:
			return 70;				

		}
	}
	/**
	* Emotes
	**/
	
	public int getAttackEmote(int i) {
		switch(definition.type) {
			/*case 1676:
			case 1677:
			case 1600:
				return */
		case 764:
		case 182:
			return 6953;
		case 763:
			return 6954;
		case 765:
			return 6953;
		case 769:
			return 7009;
		case 771:
			return 6376;
		case 770:
			return 7018;
		case 3791:
			return 6154;
		case 3792:
			return 6154;
		case 774:
			return 6945;
		case 773:
			return 6945;
		case 772:
			return 6945;
			case 2745:
				if (Misc.random(8) != 5){
					jadMage = false;
					if (Misc.random(2) == 2){
						jadRange = true;
						return 2652;
					}else{
						jadMelee = true;
						return 2655;
					}
				}else{
					jadMage = true;
					return 2656;
				}
			case 2631:
			case 2632:
				return 2633;
			case 2626:
			case 2627:
				return 2621;
			case 2629:
			case 2630:
			case 2738:
				return 2625;
			case 2744:
			case 2743:
				return 2644;
			case 2741:
			case 2742:
				return 2636;
			case 2591:
				return 2613;				
			case 2604:
				return 2612;
			case 2617:
				return 2609;
			case 2610:
				return 2610;
			case 2619:
				return 2610;				
			case 3259:
				range = true;
				gfx100(19);
				return 426;
			case 127:
				return 185;
			case 1265:
				return 1312;
			case 1622:
				return 1567;
			case 1620:
				return 1562;
			case 1633:
				return 1582;
			case 1632:
				return 1595;
			case 1609:
				return 1512;
			case 1612:
				return 1523;
		
			case 123:
				return 163;
			case 122:
				return 164;
			case 181:
				maging = true;
				if (Misc.random(20) == 2){
					druidMaging = false;
					return 716;
				}else{
					druidMaging = true;}
					gfx100(90);
					return 711;	
			case 90:
			case 91:
			case 92:
			case 93:
				return 260;
				case 221:
				return 128;
			case 58:
			case 59:
			case 60:
			case 61:
			case 62:
			case 63:
			case 64:
			case 134:
			case 977:
			case 1004:
			case 1009:
			case 1221:
			case 1473:
			case 1474:
			case 1478:
			case 1524:
			case 2034:
			case 2491:
			case 2492:
			case 2850:
				return 143;
			
			case 100:
			case 102:
			case 101:
			case 298:
			case 299:
			case 444:
			case 445:
				return 309;
			case 89:
			case 133:
			case 987:
				return 289;
			case 3810:
				return 6945;
			case 3811:
				return 6974;
			case 3790:
				return 6154;
			case 1115:
				return 7060;
			case 761:
				return 6977;
			case 3803:
			case 3804:
			case 3805:
			case 3806:
			case 3807:
			case 3809:
				return 451;
			case 3783:
				return 6964;
				
			case 3777:
			case 3778:
			case 3779:
			case 3780:
				return 3933;
			case 1604:
				return 1507;
			case 1643:
				return 729;
			case 119:
				return 99;
			case 3200:
				return 3312;
			case 1619:
				return 1552;
			case 1616:
				return 1546;
			case 1637:
				return 1586;
			case 1653:
				return 1592;
			
			case 1624:
				return 1557;
			case 49:
				return 158;
			case 269:
				return 158;
			case 941:
			case 51:
			case 52:
			case 53:
			case 54:
			case 55:
			case 1589:
			case 1590:
			case 1591:
			case 1592:
			case 72:
				if (Misc.random(8) != 5){
					dFire = false;
					if (Misc.random(2) == 2){
						return 91;
						}else{}
						return 80;
				}else{
					dFire = true;}
					return 81;			
			case 50:
				if (Misc.random(8) != 5){
					dFire = false;
					if (Misc.random(2) == 2){
						maging = false;
						return 91;
						}else{}
						maging = true;
						return 80;
				}else{
					maging = false;
					dFire = true;}
					return 81;
			case 82:
			case 83:
			case 84:
			case 934:
			case 677:
			case 752:
			case 1472:
				return 64;
			case 110:
				return 128;
			case 914:
				return 197;
			case 913: // battlemages
			case 912:
			case 3829:
				return 811;
			case 3818:
				return 811;
			case 1610:
			case 1611:
				return 1519;
			case 2783:
			return 2733;
			case 1613:
			return 1527;
			case 1615: // Aby Demon
			return 1537;
			case 2035: //spider
			return 143;	
			
			case 2033: //rat
			return 138;	
			
			case 2031: // bloodveld
			return 2070;
			
		
			case 81: // cow
			case 397:
			case 955:
			case 1691:
			case 1766:
			case 1767:
			case 1768:
			case 2310:
			case 3309:
				return 59;
			
			case 21: // hero
			return 451;	
			
			case 41: // chicken
			return 55;	
			
			case 9: // guard
			case 32: // guard
			case 20: // paladin
			case 3816:
			return 451;	
			
			case 1338: // dagannoth
			case 1340:
			case 1342:
			return 1341;
		
			case 19: // white knight
			return 406;
			case 112:
			case 111:
			case 117:
			case 116:
			return 128;
			
			case 125: // ice warrior
			return 451;
			
			case 2028: // karil
			return 2075;
					
			case 2025: // ahrim
			return 1979;
			
			case 2026: // dharok
			return 2067;
			
			case 2027: // guthan
			return 2080;
			
			case 2029: // torag
			return 0x814;
			case 2881:
				return 2855;
			case 2882:
				maging = true;
				return 2854;
			case 2883:
				return 2851;
			case 2030: // verac
			return 2062;
			case 3340:
				return 3312;
			case 12:
				return 806;
			default:
			return 0x326;		
		}
	}	

	public boolean npcGetsAnnoyed(int Npc) {
		switch(definition.type) {
			case 119:
			//case 83:
			//case 84:
			case 2882:
			case 2881:
			case 2883:
			case 58:
			//case 50:
			case 3200:
			case 1459:
			case 2627:
			case 2630:
			case 2631:
			case 2738:
			case 2741:
			case 2743:
			//case 184:
			//case 2745:
			case 2746:
			case 1472:
			//case 3783:
			case 3784:
			case 3785:
			case 3786:
			case 63:
			case 111:
			case 125:
			case 59:
			case 1153:
			case 127:
			case 1115:
			case 3790:
case 3791:
case 770:
case 771:
case 772:
case 769:
case 763:
case 773:
case 774:
case 764:
case 765:
case 3873:
case 3810:
case 3792:
case 3783:

case 78: //bat
case 912: //battlemages
case 913:
case 914:
case 184: //pirates
case 195: //castle bandits
case 2724: //skeletons
case 172: //dark wizard
case 13: //wizard
case 73: //zombies 
case 117: //hill giants
case 110: //fire giants
case 64: //ice spiders

		//	case 3793:
			//case 3811:
				return true;
			
			default:
				return false;
			}
	}
	public int getDistanceForNpc(int Npc) {
		switch(definition.type) {
			
			case 181:
			case 3818:
			case 3829:
			case 12:
			case 3822:
			case 3259:			
			case 912: //battlemages
			case 913:
			case 914:
				return 5;
			
			case 1115:
			case 3783:
			case 3810:
			case 3811:
			case 3792:
			case 3791:
			case 3790:
			case 769:
			case 770:
			case 771:
			case 774:
			case 773:
			case 772:
			case 765:
			case 764:
			case 763:
				return 20;
			case 2627:
			case 2630:
			case 2631:
			case 2738:
			case 2743:
			case 2745:
			case 1472:
			case 2883:
			case 2882:
			case 2881:
				return 30;			
			case 1160:
			case 50:
				return 10;
			case 3784:
				return 10;
			case 3785:
				return 10;
			case 3786:
				return 10;
			case 2744:
			case 2741:
			case 3793:
				return 30;				
			case 2746:
				return 10;
			case 3200:
				return 8;
			case 63:
			case 1459:
			case 111:
			case 125:
			case 59:
			case 91:
			case 82:
			case 83:
			case 1153:
			case 1154:
			case 2263:
			case 2264:
			case 2265:
			case 172: //dark wizard
			case 13: //wizard
				return 3;
			case 1:
				return 2;
			case 78: //bat
			case 195: //bandit
			case 117: //hill giant
				return 2;
			default:
				return 1;
		}
	}

	

	public int getNpcDelay(int i) {
		switch(definition.type) {
			case 1: // man
			return 6;
			case 941:
			case 51:
			case 52:
			case 53:
			case 54:
			case 55:
			case 1589:
			case 1590:
			case 1591:
			case 1592:
			case 50:
			case 72:
			case 3793:
				return 8;
			default:
			return 6;
		}
	}
	

	public int getHitDelay(int i) {
		switch(definition.type) {
		case 181:
		case 3818:
		case 3829:
		case 1643:
		case 2025:
			return 4;
		default:
			return 2;
		}
	}
	public void annoyNpcs(int npcId) {
		for (Player p : Server.getPlayerManager().getPlayers()) {
			if(p != null) {
				Client player = (Client) p;
				if(player.combatLevel > (definition.combat*2) && !Server.getNpcManager().getNPC(npcId).inWild()){
					return;
				}
				if(definition.type == 2258){ 
					return;
				}
				int absx = player.getAbsX();
				int absy = player.getAbsY();
				if (!isDead) {
				if(goodDistance(getAbsX(), getAbsY(), player.getAbsX(), player.getAbsY(), getDistanceForNpc(npcId)) && player.heightLevel == heightLevel ) {
						//if(npcGetsAnnoyed(npcId) || Server.getNpcManager().getNPC(npcId).inWild()){
						if(npcGetsAnnoyed(npcId)) {
						if(Server.getNpcManager().getNPC(npcId) != null && Server.getNpcManager().getNPC(npcId).killerId == 0) {
						if((!player.isFighting) && player.inMulti()) {
						if ((absx > 2863 && absx < 2877 && absy > 5350 && absy < 5370) || 
							(absx > 2888 && absx < 2908 && absy > 5257 && absy < 5277) || 
							(absx > 2823 && absx < 2843 && absy > 5295 && absy < 5309) || 
							(absx > 3256 && absx < 3277 && absy > 3917 && absy < 3945) || 
							(absx > 2917 && absx < 2937 && absy > 5317 && absy < 5332))  {
								setAttacker(player);
								attackPlayer(player, npcId);
								player.isFighting = true;
								Server.getNpcManager().getNPC(npcId).killerId = player.playerId;
								Server.getNpcManager().getNPC(npcId).underAttack = true;
								Server.getNpcManager().getNPC(npcId).randomWalk = false;
								return;
							}
							}
							// if(player.isFighting && player.inMulti() || (player.inWild())){
							// if ((absx > 2863 && absx < 2877 && absy > 5350 && absy < 5370) || 
							// (absx > 2888 && absx < 2908 && absy > 5257 && absy < 5277) || 
							// (absx > 2823 && absx < 2843 && absy > 5295 && absy < 5309) || 
							// (absx > 2917 && absx < 2937 && absy > 5317 && absy < 5332))  {
								// setAttacker(player);
								// attackPlayer(player, npcId);
								// player.isFighting = true;
								// Server.getNpcManager().getNPC(npcId).killerId = player.playerId;
								// Server.getNpcManager().getNPC(npcId).underAttack = true;
								// Server.getNpcManager().getNPC(npcId).randomWalk = false;
								// return;
							// }
							// }
							/*if(player.isFighting && player.inMulti() && !Server.getNpcManager().getNPC(npcId).underAttack){
								player.getActionAssistant().sendMessage("2"+definition.name);
								setAttacker(player);
								attackPlayer(player, npcId);
								player.isFighting = true;
								Server.getNpcManager().getNPC(npcId).killerId = player.playerId;
								Server.getNpcManager().getNPC(npcId).underAttack = true;
								Server.getNpcManager().getNPC(npcId).randomWalk = false;
								killerId = player.playerId;
								underAttack = true;
								randomWalk = false;	
								return;
							}	*/					
							// if(player.isFighting && !player.inMulti()){
								// setAttacker(player);
								// Server.getNpcManager().getNPC(npcId).killerId = player.playerId;
								// Server.getNpcManager().getNPC(npcId).underAttack = true;
								// Server.getNpcManager().getNPC(npcId).randomWalk = false;				
								// attackPlayer(player, npcId);
								// player.isFighting = true;
								// return;
							  //else if(!player.isFighting && !player.inMulti()){
							  else if(!player.inCombat && !player.inMulti()){
								setAttacker(player);
								Server.getNpcManager().getNPC(npcId).killerId = player.playerId;
								Server.getNpcManager().getNPC(npcId).underAttack = true;
								Server.getNpcManager().getNPC(npcId).randomWalk = false;
								attackPlayer(player, npcId);
								player.isFighting = true;
								player.inCombat = true;
								return;
							}						
						}
						}
						
					}
				}
			}
			
		}
	}
	
	public void attackPlayer(Client c, int i) {
		if(c != null) {
			if (definition.type == 3777 || definition.type == 3778 || definition.type == 3779 || definition.type == 3780) {
				return;
			}
			if(c.goodDistance(getAbsX(), getAbsY(), c.getX(), c.getY(), getDistanceForNpc(i))) {
				if(c.respawnTimer <= 0) {	
					facePlayer(c.playerId);
					attackTimer = getNpcDelay(definition.type);
					hitDelayTimer = getHitDelay(definition.type);
					startAnimation(getAttackEmote(definition.type), i);
					c.getActionAssistant().removeAllWindows();
					c.singleCombatDelay = System.currentTimeMillis();
					c.singleCombatDelay2 = System.currentTimeMillis();

				}
			} 			
		}
	}
	public void startAnimation(int animId, int i) {
		animNumber = animId;
		animUpdateRequired = true;
		updateRequired = true;
	}

	public void applyDamage(int i) {
		if(this != null) {
			if(PlayerManager.getSingleton().getPlayers()[killerId] == null) {
				return;
			}
			Client c = (Client)	PlayerManager.getSingleton().getPlayers()[killerId];

			//if(c.attackTimer <= 3 || c.attackTimer == 0 && c.npcIndex == 0 && c.oldNpcIndex == 0) {
			if (System.currentTimeMillis() - c.attackTimer > 0 && c.npcIndex == 0 && c.oldNpcIndex == 0){
				c.getActionAssistant().startAnimation(c.getCombat().getBlockEmote());
			}
			if(c.respawnTimer <= 0) {	
				int damage = Misc.random(maxHit);
				if(jadMage){
					if (10 + Misc.random(c.getCombat().calculateMagicDefence()) < 10 + Misc.random(attack)) {
						if(definition.type == 2745 && !c.prayerActive[16]) {
								int pX = c.getX();
								int pY = c.getY();// range here
								int nX = getAbsX();
								int nY = getAbsY();
								int offX = (nY - pY)* -1;
								int offY = (nX - pX)* -1;
								
								//c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,28, 448, 42, 31, -i - 1, 6);
								final Client cl = (Client) c;
								EventManager.getSingleton().addEvent(cl, new Event() {
									@Override
									public void execute(EventContainer C) {	
										C.stop();
									}
									@Override
									public void stop() {
									}
								}, 1000);						
							c.gfx100(446);
							damage = Misc.random(30);
						}
						if(definition.type == 2745 && c.prayerActive[16]) {
								int pX = c.getX();
								int pY = c.getY();// range here
								int nX = getAbsX();
								int nY = getAbsY();
								int offX = (nY - pY)* -1;
								int offY = (nX - pX)* -1;
								
								//c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,28, 448, 42, 31, -i - 1, 6);
								final Client cl = (Client) c;
								EventManager.getSingleton().addEvent(cl, new Event() {
									@Override
									public void execute(EventContainer C) {	
										C.stop();
									}
									@Override
									public void stop() {
									}
								}, 1000);					
							c.gfx100(85);
							return;							
						}
					}
					jadMage = false;
					if (c.playerLevel[3] - damage < 0) { 
						damage = c.playerLevel[3];
					}
					c.logoutDelay = System.currentTimeMillis(); // logout delay
					c.hitDiff = damage;
					c.playerLevel[3] -= damage;
					c.getActionAssistant().refreshSkill(3);
					c.updateRequired = true;
					c.hitUpdateRequired = true;						
					return;
				}
				if(jadRange){
					if (10 + Misc.random(c.getCombat().calculateRangeDefence()) < 10 + Misc.random(attack)) {
						if(definition.type == 2745 && !c.prayerActive[17]) {
								int pX = c.getX();
								int pY = c.getY();// range here
								int nX = getAbsX();
								int nY = getAbsY();
								int offX = (nY - pY)* -1;
								int offY = (nX - pX)* -1;
								
								//c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,28, 451, 42, 31, -i - 1, 6);
								final Client cl = (Client) c;
								EventManager.getSingleton().addEvent(cl, new Event() {
									@Override
									public void execute(EventContainer C) {	
										C.stop();
									}
									@Override
									public void stop() {
									}
								}, 1000);						
							c.gfx100(157);
							damage = Misc.random(30);						
						}
						if(definition.type == 2745 && c.prayerActive[17]) {
								int pX = c.getX();
								int pY = c.getY();// range here
								int nX = getAbsX();
								int nY = getAbsY();
								int offX = (nY - pY)* -1;
								int offY = (nX - pX)* -1;
								
								//c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,28, 451, 42, 31, -i - 1, 6);
								final Client cl = (Client) c;
								EventManager.getSingleton().addEvent(cl, new Event() {
									@Override
									public void execute(EventContainer C) {	
										C.stop();
									}
									@Override
									public void stop() {
									}
								}, 1000);				
							damage = 0;					
						}						
					}
					jadRange = false;
					if (c.playerLevel[3] - damage < 0) { 
						damage = c.playerLevel[3];
					}
					c.logoutDelay = System.currentTimeMillis(); // logout delay
					c.hitDiff = damage;
					c.playerLevel[3] -= damage;
					c.getActionAssistant().refreshSkill(3);
					c.updateRequired = true;
					c.hitUpdateRequired = true;						
					return;
				}
				if(jadMelee){
					if (10 + Misc.random(c.getCombat().calculateMeleeDefence()) < 10 + Misc.random(attack)) {
						if(definition.type == 2745 && !c.prayerActive[18]) {
							damage = Misc.random(30);
						}
						if(definition.type == 2745 && c.prayerActive[18]) {
							damage = 0;
						}						
					}
					jadMelee = false;
					if (c.playerLevel[3] - damage < 0) { 
						damage = c.playerLevel[3];
					}
					c.logoutDelay = System.currentTimeMillis(); // logout delay
					c.hitDiff = damage;
					c.playerLevel[3] -= damage;
					c.getActionAssistant().refreshSkill(3);
					c.updateRequired = true;
					c.hitUpdateRequired = true;						
					return;
				}			
				if(range){
					if (10 + Misc.random(c.getCombat().calculateRangeDefence()) > 10 + Misc.random(attack)) {
						damage = 0;
					}	
					if(definition.type == 3259 && !c.prayerActive[17]) {
								int pX = c.getX();
								int pY = c.getY();// range here
								int nX = getAbsX();
								int nY = getAbsY();
								int offX = (nY - pY)* -1;
								int offY = (nX - pX)* -1;
								
								c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,28, 10, 42, 31, -i - 1, 6);
								final Client cl = (Client) c;
								EventManager.getSingleton().addEvent(cl, new Event() {
									@Override
									public void execute(EventContainer C) {	
										C.stop();
									}
									@Override
									public void stop() {
									}

								}, 1000);
								//c.gfx100(85);
								damage = Misc.random(6);						
					} else if(definition.type == 3259 && c.prayerActive[17]) {
								int pX = c.getX();
								int pY = c.getY();// range here
								int nX = getAbsX();
								int nY = getAbsY();
								int offX = (nY - pY)* -1;
								int offY = (nX - pX)* -1;
								
								c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,28, 10, 42, 31, -i - 1, 6);
								final Client cl = (Client) c;
								EventManager.getSingleton().addEvent(cl, new Event() {
									@Override
									public void execute(EventContainer C) {	
										C.stop();
									}
									@Override
									public void stop() {
									}

								}, 1000);
								//c.gfx100(85);
								damage = 0;					
					}
				}
				if(maging){
					if (10 + Misc.random(c.getCombat().calculateMagicDefence()) > 10 + Misc.random(attack)) {
						damage = 0;
						magicFailed = true;
						if(definition.type == 181 && !c.prayerActive[16]) {
							int freezeDelay = 60;//freeze 
							if(freezeDelay > 0 && freezeTimer == 0) {
								freezeTimer = freezeDelay;
							}	
							if(druidMaging){
								int pX = c.getX();
								int pY = c.getY();// mage here
								int nX = getAbsX();
								int nY = getAbsY();
								int offX = (nY - pY)* -1;
								int offY = (nX - pX)* -1;
								
								c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,15, 91, 50, 20, -i - 1, 1);
								final Client cl = (Client) c;
								EventManager.getSingleton().addEvent(cl, new Event() {
									@Override
									public void execute(EventContainer C) {	
										C.stop();
									}
									@Override
									public void stop() {
									}

								}, 1000);
								c.gfx100(85);
								damage = Misc.random(5);
							} else if(!druidMaging) {
								int pX = c.getX();
								int pY = c.getY();// mage here
								int nX = getAbsX();
								int nY = getAbsY();
								int offX = (nY - pY)* -1;
								int offY = (nX - pX)* -1;
								c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,50, 109, 50, 20, -i - 1, 10);
								c.gfx100(85);
								damage = 0;	
							}
							
							druidMaging = false;
							maging = false;
							return;
						} else if(definition.type == 2882 && !c.prayerActive[16]) {
						int freezeDelay = 60;//freeze 
						if(freezeDelay > 0 && freezeTimer == 0) {
							freezeTimer = freezeDelay;
						}	
							int pX = c.getX();
							int pY = c.getY();// mage here
							int nX = getAbsX();
							int nY = getAbsY();
							int offX = (nY - pY)* -1;
							int offY = (nX - pX)* -1;
							
							c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,15, 162, 50, 20, i - 1, 1);
							final Client cl = (Client) c;
							EventManager.getSingleton().addEvent(cl, new Event() {
								@Override
								public void execute(EventContainer C) {	
									C.stop();
								}
								@Override
								public void stop() {
								}

							}, 1000);
							c.gfx100(85);
							damage = 0;
							maging = false;
							return;
						}	
					}	
				}
				
				if(definition.type == 50 || definition.type == 53 || definition.type == 54 || definition.type == 55 || 
					definition.type == 72 || definition.type == 941 || definition.type == 1590 || definition.type == 1591 || 
					definition.type == 1592){
						if(dFire && !maging){
							if(c.playerEquipment[PlayerConstants.PLAYER_SHIELD] == 1540 || c.playerEquipment[PlayerConstants.PLAYER_SHIELD] == 7905 || c.playerEquipment[PlayerConstants.PLAYER_SHIELD] == 13655 || c.prayerActive[16]) {
								gfx100(0);
								damage = 3 + Misc.random(6);
								c.getActionAssistant().sendMessage("You are protected from the dragon's fire!");
							} else if(c.playerEquipment[PlayerConstants.PLAYER_SHIELD] != 1540 && c.playerEquipment[PlayerConstants.PLAYER_SHIELD] != 7905&& c.playerEquipment[PlayerConstants.PLAYER_SHIELD] != 13655) {
								gfx100(0);
								damage = 30 + Misc.random(30);
								c.getActionAssistant().sendMessage("You are burnt by the fire!");
							}
						} else if(maging && !c.prayerActive[16]){
							int mageType = Misc.random(3);
							if( mageType == 1){
								int pX = c.getX();
								int pY = c.getY();// mage here
								int nX = getAbsX();
								int nY = getAbsY();
								int offX = (nY - pY)* -1;
								int offY = (nX - pX)* -1;
								//c.stillgfx2(96, nY+1, nX+1);
								c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,25, 396, 50, 20, -i - 1, 0);
								//c.gfx100(128);
								damage = Misc.random(30);
							}
							if( mageType == 2){
								int pX = c.getX();
								int pY = c.getY();//white mage here
								int nX = getAbsX();
								int nY = getAbsY();
								int offX = (nY - pY)* -1;
								int offY = (nX - pX)* -1;
								//c.stillgfx2(96, nY+1, nX+1);
								c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,25, 395, 50, 20, -i - 1, 0);
								//c.gfx100(128);
								damage = Misc.random(30);
							}	
							if( mageType == 3){
								int pX = c.getX();
								int pY = c.getY();// green mage here
								int nX = getAbsX();
								int nY = getAbsY();
								int offX = (nY - pY)* -1;
								int offY = (nX - pX)* -1;
								//c.stillgfx2(96, nY+1, nX+1);
								c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,25, 394, 50, 20, -i - 1, 0);
								if (Misc.random(5) == 1) {
								c.getCombat().givepoison();
								}
								damage = Misc.random(30);
							}							
						} else if(maging && c.prayerActive[16]){
							int mageType = Misc.random(3);
							if( mageType == 1){
								int pX = c.getX();
								int pY = c.getY();// blue mage here
								int nX = getAbsX();
								int nY = getAbsY();
								int offX = (nY - pY)* -1;
								int offY = (nX - pX)* -1;
								//c.stillgfx2(96, nY+1, nX+1);
								c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,25, 396, 50, 20, -i - 1, 0);
								
								damage = Misc.random(15);
							}
							if( mageType == 2){
								int pX = c.getX();
								int pY = c.getY();// mage here
								int nX = getAbsX();
								int nY = getAbsY();
								int offX = (nY - pY)* -1;
								int offY = (nX - pX)* -1;
								//c.stillgfx2(96, nY+1, nX+1);
								c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,25, 395, 50, 20, -i - 1, 0);
								//c.gfx100(128);
								damage = Misc.random(15);
							}	
							if( mageType == 3){
								int pX = c.getX();
								int pY = c.getY();// mage here
								int nX = getAbsX();
								int nY = getAbsY();
								int offX = (nY - pY)* -1;
								int offY = (nX - pX)* -1;
								//c.stillgfx2(96, nY+1, nX+1);
								c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,25, 394, 50, 20, -i - 1, 0);
								//c.gfx100(128);
								damage = Misc.random(15);
							}	
						} else {	
							if(c.prayerActive[18]){
								damage = Misc.random(7);
							} else {
								damage = Misc.random(10);
							}
						}
					}
					else if(definition.type == 2025 && c.prayerActive[16]) {
							c.gfx100(85);
							damage = 0;	
					} else if(definition.type == 181 && !c.prayerActive[16]) {
						int freezeDelay = 60;//freeze 
						if(freezeDelay > 0 && freezeTimer == 0) {
							freezeTimer = freezeDelay;
						}	
						if(druidMaging){
							int pX = c.getX();
							int pY = c.getY();// mage here
							int nX = getAbsX();
							int nY = getAbsY();
							int offX = (nY - pY)* -1;
							int offY = (nX - pX)* -1;
							
							c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,15, 91, 50, 20, -i - 1, 1);
							final Client cl = (Client) c;
							EventManager.getSingleton().addEvent(cl, new Event() {
								@Override
								public void execute(EventContainer C) {	
									C.stop();
								}
								@Override
								public void stop() {
								}

							}, 1000);
							c.gfx100(92);
							damage = Misc.random(5);
						} else if(!druidMaging) {
							int pX = c.getX();
							int pY = c.getY();// mage here
							int nX = getAbsX();
							int nY = getAbsY();
							int offX = (nY - pY)* -1;
							int offY = (nX - pX)* -1;
							c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,50, 109, 50, 20, -i - 1, 10);
							c.gfx100(110);
							damage = 0;	
						}
						druidMaging = false;
						maging = false;
					} else if(definition.type == 181 && c.prayerActive[16]) {
						int freezeDelay = 60;//freeze 
						if(freezeDelay > 0 && freezeTimer == 0) {
							freezeTimer = freezeDelay;
						}	
						if(druidMaging){
							int pX = c.getX();
							int pY = c.getY();// mage here
							int nX = getAbsX();
							int nY = getAbsY();
							int offX = (nY - pY)* -1;
							int offY = (nX - pX)* -1;
							
							c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,15, 91, 50, 20, -i - 1, 1);
							final Client cl = (Client) c;
							EventManager.getSingleton().addEvent(cl, new Event() {
								@Override
								public void execute(EventContainer C) {	
									C.stop();
								}
								@Override
								public void stop() {
								}

							}, 1000);
							c.gfx100(85);
							//damage = Misc.random(5);
						} else if(!druidMaging) {
							int pX = c.getX();
							int pY = c.getY();// mage here
							int nX = getAbsX();
							int nY = getAbsY();
							int offX = (nY - pY)* -1;
							int offY = (nX - pX)* -1;
							c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,15, 109, 50, 20, -i - 1, 1);
							final Client cl = (Client) c;
							EventManager.getSingleton().addEvent(cl, new Event() {
								@Override
								public void execute(EventContainer C) {	
									C.stop();
								}
								@Override
								public void stop() {
								}

							}, 1000);							
							c.gfx100(85);
							//damage = 0;	
						}
						druidMaging = false;
						maging = false;		//marker 3
					} else if(definition.type == 3793) {
							damage = Misc.random(12);	
					}
					else if (absX >= 2800 && absX <= 2950 && absY >= 5245 && absY <= 5385) {
					if (definition.type == 3818 && c.prayerActive[16]) {
						c.gfx100(78);
						damage = 0;
					} else if (definition.type == 3818 && !c.prayerActive[16]) {
						c.gfx100(78);
						damage = Misc.random(10);
					} else if (definition.type == 3829 && c.prayerActive[16]) {
						c.gfx100(76);
						damage = 0;
					}else if (definition.type == 3829 && !c.prayerActive[16]) {
						c.gfx100(76);
						damage = Misc.random(10);
					} else if ((definition.type == 3816 || definition.type == 3822) && c.prayerActive[18]) {
						damage = 0;
					}else if ((definition.type == 3816 || definition.type == 3822) && !c.prayerActive[18]) {
						damage = Misc.random(10);
					} else if ((definition.type == 116 || definition.type == 113 || definition.type == 71 ||
							definition.type == 123 || definition.type == 101 || definition.type == 122 || 
							definition.type == 102 || definition.type == 100) && !c.prayerActive[18]) { // NO PRAYER CONDITION bandos minor
										damage = Misc.random(10);
					} else if ((definition.type == 116 || definition.type == 113 || definition.type == 71 ||
							definition.type == 123 || definition.type == 101 || definition.type == 122 || 
							definition.type == 102 || definition.type == 100) && c.prayerActive[18]) { // NO PRAYER CONDITION bandos minor
										damage = 0;
					}
					if ((definition.type == 1115 || definition.type == 3783 || definition.type == 3810) && !c.prayerActive[18]) { // NO PRAYER CONDITION bosses
										damage = Misc.random(45);
							}
							else if ((definition.type == 3790 || definition.type == 3791 || definition.type == 3791 ||
								  definition.type == 770 || definition.type == 769 || definition.type == 771 ||
								  definition.type == 772 || definition.type == 773 || definition.type == 774 ||
								  definition.type == 763) && !c.prayerActive[18]) { //Minions no prayer
								  damage = Misc.random(25);
							}
						else if ((definition.type == 765 || definition.type == 764) && !c.prayerActive[17]) { // NO PRAYER CONDITION ARM MINIONS
											damage = Misc.random(20);
						}
						else if (definition.type == 3811 && !c.prayerActive[17]) { // NO PRAYER CONDITION arma
											damage = Misc.random(60);
						}
						 else if ((definition.type == 1115 || definition.type == 3783 || definition.type == 3810)  && c.prayerActive[18]) { // Hit through melee pray bosses
								if (Misc.random(10) == 1) {
									damage = Misc.random(25);
								} else {
									damage = Misc.random(20);
								}
						}
						 else if (definition.type == 3811  && c.prayerActive[17]) { // Hit through range pray arma
								if (Misc.random(10) == 1) {
									damage = Misc.random(25);
								} else {
									damage = Misc.random(20);
								}
						}
						else if ((definition.type == 3790 || definition.type == 3791 || definition.type == 3791 ||
								  definition.type == 770 || definition.type == 769 || definition.type == 771 ||
								  definition.type == 772 || definition.type == 773 || definition.type == 774 ||
								  definition.type == 763
						) && c.prayerActive[18]) { //minions hit through melee
								if (Misc.random(10) == 1) {
									damage = Misc.random(13);
								} else {
									damage = Misc.random(10);
								}
						} 
						else if ((definition.type == 764 || definition.type == 765) && c.prayerActive[17]) { //ARMADYL minions range
								if (Misc.random(10) == 1) {
									damage = Misc.random(13);
								} else {
									damage = Misc.random(10);
								}
						} 
					}
					
					else if(definition.type == 3793 && !c.prayerActive[18]) {
							damage = Misc.random(15);
					} else if(definition.type == 3793 && !c.prayerActive[17]) {
							damage = Misc.random(15);
					} else if(definition.type == 3793 && !c.prayerActive[16]) {
							damage = Misc.random(15);
					} else if(definition.type == 3793 && c.prayerActive[18]) {
							damage = Misc.random(5);
					} else if(definition.type == 3793 && c.prayerActive[17]) {
							damage = Misc.random(5);
					} else if(definition.type == 3793 && c.prayerActive[16]) {
							damage = Misc.random(5);						
					} else if(definition.type == 2028 && !c.prayerActive[17]) {
							damage = Misc.random(25);							
					} else if(definition.type == 2028 && c.prayerActive[17]) {
							damage = 0;								
					} else if(definition.type == 3795 && c.prayerActive[18]) {
							damage = Misc.random(15);
							c.playerLevel[5] = c.playerLevel[5] - damage/3;	
							c.getActionAssistant().refreshSkill(5);
					} else if(definition.type == 3795 && !c.prayerActive[18]) {
							damage = Misc.random(70);
							c.playerLevel[5] = c.playerLevel[5] - damage/3;	
							c.getActionAssistant().refreshSkill(5);
					} else if(definition.type == 1643 && c.prayerActive[16]) {
							int pX = c.getX();
							int pY = c.getY();// mage here
							int nX = getAbsX();
							int nY = getAbsY();
							int offX = (nY - pY)* -1;
							int offY = (nX - pX)* -1;
							//c.stillgfx2(96, nY+1, nX+1);
							c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,25, 130, 50, 20, -i - 1, 0);
							c.gfx100(85);
							damage = 0;	
					} else if(definition.type == 12 && c.prayerActive[16]) {
							gfx0(35);
							int pX = c.getX();
							int pY = c.getY();// mage here
							int nX = getAbsX();
							int nY = getAbsY();
							int offX = (nY - pY)* -1;
							int offY = (nX - pX)* -1;
							//c.stillgfx2(96, nY+1, nX+1);
							c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,25, 35, 50, 20, -i - 1, 0);
							//c.gfx100(85);
							damage = 0;		
					} else if(definition.type == 12 && !c.prayerActive[16]) {
							int pX = c.getX();
							int pY = c.getY();// mage here
							int nX = getAbsX();
							int nY = getAbsY();
							int offX = (nY - pY)* -1;
							int offY = (nX - pX)* -1;
							//c.stillgfx2(96, nY+1, nX+1);
							c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,25, 35, 50, 20, -i - 1, 0);
							//c.gfx100(85);
							damage = Misc.random(5);								
					} else if(definition.type == 1643 && !c.prayerActive[16]) {
							int pX = c.getX();
							int pY = c.getY();// mage here
							int nX = getAbsX();
							int nY = getAbsY();
							int offX = (nY - pY)* -1;
							int offY = (nX - pX)* -1;
							//c.stillgfx2(96, nY+1, nX+1);
							c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,25, 130, 50, 20, -i - 1, 0);
							c.gfx100(128);
							damage = Misc.random(12);	
					} else if(definition.type == 1604 && c.prayerActive[16]) {
							int pX = c.getX();
							int pY = c.getY();// mage here
							int nX = getAbsX();
							int nY = getAbsY();
							int offX = (nY - pY)* -1;
							int offY = (nX - pX)* -1;
							//c.stillgfx2(96, nY+1, nX+1);
							//c.getActionAssistant().createPlayersProjectile(nY, nX, offY, offX, 50,25, 130, 50, 20, -i - 1, 0);
							c.gfx100(255);
							damage = 0;	
					} else if(definition.type == 1604 && !c.prayerActive[16]) {
							int pX = c.getX();
							int pY = c.getY();// mage here
							int nX = getAbsX();
							int nY = getAbsY();
							int offX = (nY - pY)* -1;
							int offY = (nX - pX)* -1;
							//c.stillgfx2(96, nY+1, nX+1);
							//c.getActionAssistant().createPlayersProjectile(nY, nX, offY, offX, 50,25, 130, 50, 20, -i - 1, 0);
							c.gfx100(255);
							damage = Misc.random(20);							
					} else if(definition.type == 2025 && !c.prayerActive[16]) {
							//c.gfx100(369);
							//Server.getStillGraphicsManager().stillGraphics(c,c.getAbsX(), c.getAbsY(), 0, 369, 0);
							c.gfx0(369);
							int freezeDelay = 60;//freeze 
							if(freezeDelay > 0 && c.freezeTimer == 0) {
								c.freezeTimer = freezeDelay;
							}
							damage = Misc.random(30);	
					} else if(definition.type == 2882 && c.prayerActive[16]) {
						int freezeDelay = 60;//freeze 
						if(freezeDelay > 0 && freezeTimer == 0) {
							freezeTimer = freezeDelay;
						}	
							int pX = c.getX();
							int pY = c.getY();// mage here
							int nX = getAbsX();
							int nY = getAbsY();
							int offX = (nY - pY)* -1;
							int offY = (nX - pX)* -1;
							
							c.getCombat().createPlayersProjectile(nY, nX+1, offY, offX, 50,15, 162, 50, 20, i - 1, 1);
							final Client cli = (Client) c;
							EventManager.getSingleton().addEvent(cli, new Event() {
								@Override
								public void execute(EventContainer C) {	
									C.stop();
								}
								@Override
								public void stop() {
								}

							}, 1000);
							c.gfx100(85);
							damage = 0;
							maging = false;
					} else if(definition.type == 2882 && !c.prayerActive[16]) {
						int freezeDelay = 60;//freeze 
						if(freezeDelay > 0 && freezeTimer == 0) {
							freezeTimer = freezeDelay;
						}	
							int pX = c.getX();
							int pY = c.getY();// mage here
							int nX = getAbsX();
							int nY = getAbsY();
							int offX = (nY - pY)* -1;
							int offY = (nX - pX)* -1;
							
							c.getCombat().createPlayersProjectile(nY, nX, offY, offX, 50,15, 162, 50, 20, i - 1, 1);
							final Client clie = (Client) c;
							EventManager.getSingleton().addEvent(clie, new Event() {
								@Override
								public void execute(EventContainer C) {	
									C.stop();
								}
								@Override
								public void stop() {
								}

							}, 1000);
							c.gfx100(163);
							damage = Misc.random(50);
							maging = false;
					} else if(definition.type == 912 && c.prayerActive[16]) {
							c.gfx100(85);
							damage = 0;	
					} else if(definition.type == 914 && c.prayerActive[16]) {
							c.gfx100(85);
							damage = 0;	
					} else if(definition.type == 913 && c.prayerActive[16]) {
							c.gfx100(85);
							damage = 0;							
					} else if(definition.type == 912 && !c.prayerActive[16]) {
							c.gfx100(78);
							damage = Misc.random(30);
					} else if(definition.type == 914 && !c.prayerActive[16]) {
							c.gfx100(77);
							damage = Misc.random(30);
					} else if(definition.type == 913 && !c.prayerActive[16]) {
							c.gfx100(76);
							damage = Misc.random(30);							
					} else if(definition.type == 2881 && c.prayerActive[17]) {
							c.gfx100(28);
							damage = Misc.random(5);	
					} else if(definition.type == 2881 && !c.prayerActive[17]) {
							c.gfx100(28);
							damage = Misc.random(40);							
					} else if(definition.type == 1160 && c.prayerActive[16]) {
							damage = Misc.random(25);	
					} else if(definition.type == 1160 && !c.prayerActive[16]) {
							damage = Misc.random(50);						
					} else if(definition.type == 3200 || definition.type == 3340 || definition.type == 1914 && c.prayerActive[16]) {
							damage = Misc.random(10);	
					} else if(definition.type == 3200 || definition.type == 3340 || definition.type == 1914 && !c.prayerActive[16]) {
							damage = Misc.random(15);						
					} else if(definition.type == 3200 || definition.type == 3340 || definition.type == 1914 && c.prayerActive[17]) {
							damage = Misc.random(10);	
					} else if(definition.type == 3200 || definition.type == 3340 || definition.type == 1914 && !c.prayerActive[17]) {
							damage = Misc.random(15);
					} else if(definition.type == 3200 || definition.type == 3340 || definition.type == 1914 && c.prayerActive[18]) {
							damage = Misc.random(10);	
					} else if(definition.type == 3200 || definition.type == 3340 || definition.type == 1914 && !c.prayerActive[18]) {
							damage = Misc.random(15);				
					} else if(definition.type == 3200 && Misc.random(3)==1){
						//animNumber = 3146;
						damage = 0;  
					
						//c.getItems().removeItem(c.playerEquipment[3], 3);
						//c.getActionAssistant().sendMessage("The chaos elemental removes your weapon!");
						
											
					} else if (definition.type == 86 || definition.type == 41 || definition.type == 3) {
					damage = 0;
					}
					else if (c.prayerActive[18] && (definition.type ==934 ||definition.type ==237 ||definition.type ==277)) {
				damage = Misc.random(10);
				}
					else if(c.prayerActive[18]) { // protect from melee
						damage = 0;
				}
				
				if(definition.type == 182 && c.prayerActive[17]) {
							damage = 0;	
					

} else if(definition.type == 1618 && c.prayerActive[18]) {
							damage = 0;	}
							if (c.canVengeance && damage > 0) {
					//c.hitDiff = damage;
					c.canVengeance = false;
					c.forcedChat("Taste vengeance!");
					c.hitUpdateRequired = true;
					c.updateRequired = true;
					c.appearanceUpdateRequired = true;
					hitDiff -= damage/2;
					hp -= damage;				
					setAnimUpdateRequired(true);
					setUpdateRequired(true);
					hitUpdateRequired = true;
				}
				if (c.playerEquipment[PlayerConstants.PLAYER_SHIELD] == 7814) {
			
					double div = damage *0.7;
					int test = (int)div;
					test = test - 1; //correct for rounding

					if (c.playerRights < 3) {
						c.playerLevel[5] -= 0.15 * damage;
					}
					if(c.playerLevel[5] <= 0) {
						c.playerLevel[5] = 0;
					}
					c.getActionAssistant().refreshSkill(5);
					damage = (int)div;
					if (c.playerLevel[3] - damage < 0) { 
						damage = c.playerLevel[3];
					}
				}
			else if (c.playerEquipment[PlayerConstants.PLAYER_SHIELD] == 13742) {
						int elysain = damage / 4;
			damage = damage - elysain;
			}
			if (c.playerEquipment[PlayerConstants.PLAYER_HAT] == 13898) {
				c.stathelm -= damage;
				if (c.stathelm <= 0) {
					c.stathelm = 0;
				}
	
			}
			else if (c.playerEquipment[PlayerConstants.PLAYER_HAT] == 9006) {
				c.zurhelm -= damage;
				if (c.zurhelm <= 0) {
					c.zurhelm = 0;
				}
			}
			else if (c.playerEquipment[PlayerConstants.PLAYER_HAT] == 9010) {
				c.morrhelm -= damage;
				if (c.morrhelm <= 0) {
					c.morrhelm = 0;
				}
			}
			if (c.playerEquipment[PlayerConstants.PLAYER_CHEST] == 13889) {
				c.vplate -= damage;
				if (c.vplate <= 0) {
					c.vplate = 0;
				}
			}
			else if (c.playerEquipment[PlayerConstants.PLAYER_CHEST] == 13860) {
				c.zplate -= damage;
				if (c.zplate <= 0) {
					c.zplate = 0;
				}
			}
			else if (c.playerEquipment[PlayerConstants.PLAYER_CHEST] == 13872) {
				c.mplate -= damage;
				if (c.mplate <= 0) {
					c.mplate = 0;
				}
			}
			else if (c.playerEquipment[PlayerConstants.PLAYER_CHEST] == 13886) {
				c.splate -= damage;
				if (c.splate <= 0) {
					c.splate = 0;
				}
			}
			if (c.playerEquipment[PlayerConstants.PLAYER_LEGS] == 13895) {
				c.vleg -= damage;
				if (c.vleg <= 0) {
					c.vleg = 0;
				}
			}
			else if (c.playerEquipment[PlayerConstants.PLAYER_LEGS] == 9009) {
				c.mleg -= damage;
				if (c.mleg <= 0) {
					c.mleg = 0;
				}
			}
			else if (c.playerEquipment[PlayerConstants.PLAYER_LEGS] == 9004) {
				c.zleg -= damage;
				if (c.zleg <= 0) {
					c.zleg = 0;
				}
			}
			else if (c.playerEquipment[PlayerConstants.PLAYER_LEGS] == 13892) {
				c.sleg -= damage;
				if (c.sleg <= 0) {
					c.sleg = 0;
				}
			}
				if (c.playerLevel[3] - damage < 0) { 
					damage = c.playerLevel[3];
				}
				c.logoutDelay = System.currentTimeMillis(); // logout delay
				c.hitDiff = damage;
				c.playerLevel[3] -= damage;
				c.getActionAssistant().refreshSkill(3);
				c.updateRequired = true;
				c.hitUpdateRequired = true;
				
			}
		}
	}
	/**
	* Npc Follow Player
	**/
	
	public int GetMove(int Place1,int Place2) { 
		if ((Place1 - Place2) == 0) {
            return 0;
		} else if ((Place1 - Place2) < 0) {
			return 1;
		} else if ((Place1 - Place2) > 0) {
			return -1;
		}
        	return 0;
   	 }
	  /* public void killMyNPCs(){
        for(int i = 0; i < Server.getNpcManager().getNPC(i); i++)
            if(Server.getNpcManager().getNPC(i) != null) {
				if(npc.definition.type == 2627 || npc.definition.type == 2630 || 
					npc.definition.type == 2631 || npc.definition.type == 2741 || 
					npc.definition.type == 2743 || npc.definition.type == 2745 || 
					npc.definition.type == 2746 || npc.definition.type == 2738) {
					if(npc.heightLevel == client.heightLevel){
						npc.absX = 0;
						npc.absY = 0;
						npc.followPlayer = null;
					}
				}
			}
	}*/
	
	public void followPlayer(Client c) {
		if (c == null) {
			return;
		}
		if (c.respawnTimer > 0) {
			facePlayer(0);
			randomWalk = true;
	      	underAttack = false;	
			return;
		}
		int playerX = c.getX();
		int playerY = c.getY();
		boolean canwalk = true;
		randomWalk = false;
		if((getAbsX() < makeX + Config.NPC_FOLLOW_DISTANCE) && (getAbsX() > makeX - Config.NPC_FOLLOW_DISTANCE) && (getAbsY() < makeY + Config.NPC_FOLLOW_DISTANCE) && (getAbsY() > makeY - Config.NPC_FOLLOW_DISTANCE)) {
		if(heightLevel == c.heightLevel) {
			if(c != null && this != null) {
				if (playerY < getAbsY()) {
				moveX = GetMove(getAbsX(), playerX);
				moveY = GetMove(getAbsY(), playerY + 1);
				if(WorldMap.isWalkAble(heightLevel, getAbsX(), getAbsY(), getAbsX(), getAbsY()+moveY) == false)
				canwalk = false;
			} else if (playerY > getAbsY()) {
				moveX = GetMove(getAbsX(), playerX);
				moveY = GetMove(getAbsY(), playerY - 1);
				if(WorldMap.isWalkAble(heightLevel, getAbsX(), getAbsY(), getAbsX(), getAbsY()-moveY) == false)
				canwalk = false;
			} else if (playerX < getAbsX()) {
				moveX = GetMove(getAbsX(), playerX + 1);
				moveY = GetMove(getAbsY(), playerY);
				if(WorldMap.isWalkAble(heightLevel, getAbsX(), getAbsY(), getAbsX()+moveX, getAbsY()) == false)
				canwalk = false;
			} else if (playerX > getAbsX()) {
				moveX = GetMove(getAbsX(), playerX - 1);
				moveY = GetMove(getAbsY(), playerY);
				if(WorldMap.isWalkAble(heightLevel, getAbsX(), getAbsY(), getAbsX()-moveX, getAbsY()) == false)
				canwalk = false;
			} else if(playerX == getAbsX() || playerY == getAbsY()) {
						int o = Misc.random(4);
						switch(o) {
							case 4:
							moveX = GetMove(getAbsX(), playerX);
							moveY = GetMove(getAbsY(), playerY+1);
							if(WorldMap.isWalkAble(heightLevel, getAbsX(), getAbsY(), getAbsX(), getAbsY()+moveY) == false)
							canwalk = false;
							break;
							
							case 1:
							moveX = GetMove(getAbsX(), playerX);
							moveY = GetMove(getAbsY(), playerY-1);
							if(WorldMap.isWalkAble(heightLevel, getAbsX(), getAbsY(), getAbsX(), getAbsY()-moveY) == false)
							canwalk = false;
							break;
							
							case 2:
							moveX = GetMove(getAbsX(), playerX+1);
							moveY = GetMove(getAbsY(), playerY);
							if(WorldMap.isWalkAble(heightLevel, getAbsX(), getAbsY(), getAbsX()+moveX, getAbsY()) == false)
							canwalk = false;
							break;
							
							case 3:
							moveX = GetMove(getAbsX(), playerX-1);
							moveY = GetMove(getAbsY(), playerY);
							if(WorldMap.isWalkAble(heightLevel, getAbsX(), getAbsY(), getAbsX()-moveX, getAbsY()) == false)
							canwalk = false;
							break;
						}	
					}
					int x = (getAbsX() + moveX);
					int y = (getAbsY() + moveY);
					if (VirtualWorld.I(heightLevel, getAbsX(), getAbsY(), x, y, 0) && canwalk)
						getNextNPCMovement(definition.type);
					else {
						moveX = 0;
						moveY = 0;
					}        
					
				//	if(canwalk == true)
					//	getNextNPCMovement(definition.type); 
					//	updateRequired = true;
					
				}
				
			} else {
				facePlayer(0);
				underAttack = false;	
				randomWalk = true;
				killerId = 0;
				killedBy = 0;
			}
		} else {
			facePlayer(0);
	      	underAttack = false;	
			randomWalk = true;
			killerId = 0;
			killedBy = 0;
		}
	}
	public void getNextNPCMovement(int i) {
		direction = -1;
		if(freezeTimer <= 0) {
			direction = getNextWalkingDirection();
		}
	}
/*	public int getNextWalkingDirection() {
		int dir;
		dir = Misc.direction(absX, absY, (absX + moveX), (absY + moveY));
		if(dir == -1) return -1;
		dir >>= 1;
		absX += moveX;
		absY += moveY;
		dirUpdateRequired = true;
		return dir;
	}*/
	
	public int getNextWalkingDirection() {
		currentTile = new Tile(absX + moveX, absY + moveY, heightLevel);
		if(!WalkingCheck.tiles.containsKey(currentTile.getH() << 28 | currentTile.getX() << 14 | currentTile.getY())){
			int dir;
			dir = Misc.direction(absX, absY, (absX + moveX), (absY + moveY));
			if (dir == -1)
				return -1;
			dir >>= 1;
			absX += moveX;
			absY += moveY;
			return dir;
		} else if(WalkingCheck.tiles.get(currentTile.getH() << 28 | currentTile.getX() << 14 | currentTile.getY()) == true) {
			return -1;
		} else {
			return -1;
		}
	}
	
	public boolean npcInMulti() {
		if((absX >= 3029 && absX <= 3374 && absY >= 3759 && absY <= 3903) || 
		   (absX >= 2250 && absX <= 2280 && absY >= 4670 && absY <= 4720) ||
		   (absX >= 3198 && absX <= 3380 && absY >= 3904 && absY <= 3970) ||
		   (absX >= 3191 && absX <= 3326 && absY >= 3510 && absY <= 3759) ||
		   (absX >= 2987 && absX <= 3006 && absY >= 3912 && absY <= 3937) ||
		   (absX >= 2245 && absX <= 2295 && absY >= 4675 && absY <= 4720) ||
		   (absX >= 2450 && absX <= 3520 && absY >= 9450 && absY <= 9550) ||
		   (absX >= 3006 && absX <= 3071 && absY >= 3602 && absY <= 3710) ||
		   (absX >= 3134 && absX <= 3192 && absY >= 3519 && absY <= 3646)
		   ){
			return true;
		}
		return false;
	}
	public boolean goodDistance(int objectX, int objectY, int playerX, int playerY, int distance) {
		for (int i = 0; i <= distance; i++) {
		  for (int j = 0; j <= distance; j++) {
			if ((objectX + i) == playerX && ((objectY + j) == playerY || (objectY - j) == playerY || objectY == playerY)) {
				return true;
			} else if ((objectX - i) == playerX && ((objectY + j) == playerY || (objectY - j) == playerY || objectY == playerY)) {
				return true;
			} else if (objectX == playerX && ((objectY + j) == playerY || (objectY - j) == playerY || objectY == playerY)) {
				return true;
			}
		  }
		}
		return false;
	}

}